@page
@using ToDoList.Repository;
@using ToDoList.Services.DataTransferObejcts;
@using ToDoList.Services.Enums;
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <table class="table table-light table-striped text-center">
        <thead>
            <tr>
                <th>Description</th>
                <th>Priority</th>
                <th>Created</th>
                <th>Completed</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.ToDoItems.Count == 0)
            {
                <tr>
                    <td>There are no items in the list.</td>
                </tr>
            }
            else
            {
                <form asp-page-handler="CompleteTask" method="post">
                    @foreach (ToDoItemDTO item in Model.ToDoItems)
                    {
                        <tr>
                            <td>@item.Description</td>
                            <td>@item.Priority</td>
                            <td>@item.DateCreated <input type="hidden" name="itemGuid" value="@item.ID"/></td>
                            <td><input class="form-check-input" value="" asp-for="@item.IsCompleted" type="submit" /></td>
                            <td>
                                <a class="btn btn-warning" asp-page-handler="Edit" asp-route-id="@item.ID">Edit</a>
                            </td>
                        </tr>
                    }

                </form>

            }
        </tbody>
    </table>
</div>

<!--Off canvas for creating a new task.-->
<div class="offcanvas offcanvas-start" tabindex="-1" id="createNewTask" aria-labelledby="createNewTaskLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="createNewTaskLabel">Create New Task</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div>
            In here you can create a new task.
        </div>
        <hr />
        <form method="post" asp-page-handler="CreateNewTask">
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <input asp-for="@Model.Description" id="description" class="form-control" name="description" />
            </div>
            <div class="mb-3">
                <label for="priority" class="form-label">Priority</label>
                <select class="form-select" name="priorityForm">
                    @foreach (PriorityDTO priority in Enum.GetValues(typeof(PriorityDTO)))
                    {
                        <option value="@priority">@priority</option>
                    }
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>
</div>